(()=>{"use strict";const t={multiply:function(t,e){let i=t[0],s=t[1],n=t[2],h=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8],d=e[0],g=e[1],u=e[2],p=e[3],L=e[4],I=e[5],w=e[6],E=e[7],f=e[8];return[d*i+g*h+u*a,d*s+g*r+u*c,d*n+g*o+u*l,p*i+L*h+I*a,p*s+L*r+I*c,p*n+L*o+I*l,w*i+E*h+f*a,w*s+E*r+f*c,w*n+E*o+f*l]},translation:function(t,e){return[1,0,0,0,1,0,t,e,1]},rotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},scaling:function(t,e){return[t,0,0,0,e,0,0,0,1]},projection:function(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]},translate:function(e,i,s){return t.multiply(e,t.translation(i,s))},rotate:function(e,i){return t.multiply(e,t.rotation(i))},scale:function(e,i,s){return t.multiply(e,t.scaling(i,s))}},e={translation:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]},xRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]},yRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]},zRotation:function(t){let e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]},translate:function(t,i,s,n){return e.multiply(t,e.translation(i,s,n))},xRotate:function(t,i){return e.multiply(t,e.xRotation(i))},yRotate:function(t,i){return e.multiply(t,e.yRotation(i))},zRotate:function(t,i){return e.multiply(t,e.zRotation(i))},scale:function(t,i,s,n){return e.multiply(t,e.scaling(i,s,n))},multiply:function(t,e){let i=e[0],s=e[1],n=e[2],h=e[3],r=e[4],o=e[5],a=e[6],c=e[7],l=e[8],d=e[9],g=e[10],u=e[11],p=e[12],L=e[13],I=e[14],w=e[15],E=t[0],f=t[1],A=t[2],_=t[3],T=t[4],R=t[5],C=t[6],O=t[7],y=t[8],S=t[9],x=t[10],v=t[11],b=t[12],m=t[13],j=t[14],N=t[15];return[i*E+s*T+n*y+h*b,i*f+s*R+n*S+h*m,i*A+s*C+n*x+h*j,i*_+s*O+n*v+h*N,r*E+o*T+a*y+c*b,r*f+o*R+a*S+c*m,r*A+o*C+a*x+c*j,r*_+o*O+a*v+c*N,l*E+d*T+g*y+u*b,l*f+d*R+g*S+u*m,l*A+d*C+g*x+u*j,l*_+d*O+g*v+u*N,p*E+L*T+I*y+w*b,p*f+L*R+I*S+w*m,p*A+L*C+I*x+w*j,p*_+L*O+I*v+w*N]},projection:function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},orthographic:function(t,e,i,s,n,h){return[2/(e-t),0,0,0,0,2/(s-i),0,0,0,0,2/(n-h),0,(t+e)/(t-e),(i+s)/(i-s),(n+h)/(n-h),1]}},i={m3:t,m4:e,createShader:function(t,e,i){const s=t.createShader(e);if(s){if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.log(t.getShaderInfoLog(s)),t.deleteShader(s)}},createProgram:function(t,e,i){const s=t.createProgram();if(s){if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))return s;console.log(t.getProgramInfoLog(s)),t.deleteProgram(s)}}};class s{constructor(t){const e=t.getContext("webgl");if(e){this.gl=e,this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.vertexSource="\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * a_position;\n    v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}\n",this.fragmentSource="\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n}\n";let t=i.createShader(this.gl,this.gl.VERTEX_SHADER,this.vertexSource),s=i.createShader(this.gl,this.gl.FRAGMENT_SHADER,this.fragmentSource);if(t&&s){const e=i.createProgram(this.gl,t,s);e&&(this.program=e)}this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(this.program,"a_texcoord");const n=this.gl.getUniformLocation(this.program,"u_matrix");n&&(this.matrixLocation=n);const h=this.gl.getUniformLocation(this.program,"u_textureMatrix");h&&(this.textureMatrixLocation=h);const r=this.gl.getUniformLocation(this.program,"u_texture");r&&(this.textureLocation=r);const o=this.gl.createBuffer();o&&(this.positionBuffer=o);const a=this.gl.createBuffer();a&&(this.texcoordBuffer=a)}}static init(t){this.canvas=t}static getInstance(){return this.instance||(this.instance=new s(s.canvas)),this.instance}loadImageAndCreateTextureInfo(t){const e=this.gl.createTexture();if(e){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR);let i={width:1,height:1,texture:e},s=new Image;return s.addEventListener("load",(t=>{i.width=s.width,i.height=s.height,this.gl&&(this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s))})),s.src=t,i}return{width:0,height:0,texture:WebGLTexture}}draw(t,e,i,s,n,h,r,o,a,c,l,d){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),c&&l&&d?this.drawImage(t.texture,t.width,t.height,e,i,s,n,h,r,o,a,c,l,d):this.drawImage(t.texture,t.width,t.height,e,i,s,n,h,r,o,a)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}drawImage(t,e,s,n,h,r,o,a,c,l,d,g,u,p){if(this.gl){this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.vertexAttribPointer(this.texcoordLocation,2,this.gl.FLOAT,!1,0,0);let L=i.m4.orthographic(0,this.gl.canvas.width,this.gl.canvas.height,0,-1,1);L=i.m4.translate(L,a,c,0),g&&u&&p&&(L=i.m4.translate(L,g*l,u*d,0),L=i.m4.zRotate(L,p),L=i.m4.translate(L,-g*l,-u*d,0)),L=i.m4.scale(L,l,d,1),this.gl.uniformMatrix4fv(this.matrixLocation,!1,L);let I=i.m4.translation(n/e,h/s,0);I=i.m4.scale(I,r/e,o/s,1),this.gl.uniformMatrix4fv(this.textureMatrixLocation,!1,I),this.gl.uniform1i(this.textureLocation,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}}const n=s;class h{constructor(){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sceneList=[],n.init(this.canvas)}static getInstance(){return this.instance||(this.instance=new h),this.instance}handleInput(t){this.sceneList.forEach((e=>{e.handleInput(t)}))}update(t){this.sceneList.forEach((e=>{e.update(t)}))}render(){n.getInstance().clear(),this.sceneList.forEach((t=>{t.render()})),document.body.appendChild(this.canvas)}addScene(t){this.sceneList.push(t)}setSceneWidth(t){this.canvas.width=t}setSceneHeight(t){this.canvas.height=t}reloadScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!0),this.sceneList[t].setIsUpdated(!0),this.sceneList[t].reload())}startScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!0),this.sceneList[t].setIsUpdated(!0),this.sceneList[t].reload())}stopScene(t){t>=0&&t<this.sceneList.length&&(this.sceneList[t].setIsRendered(!1),this.sceneList[t].setIsUpdated(!1))}pauseScene(t){t>=0&&t<this.sceneList.length&&this.sceneList[t].setIsUpdated(!1)}resumeScene(t){t>=0&&t<this.sceneList.length&&this.sceneList[t].setIsUpdated(!0)}}const r=h,o=class{constructor(t){this.event=t}getEvent(){return this.event}};class a{constructor(){this.mouseEventList=[],this.keyboardEventList=[]}register(t){this.scene=t}static getInstance(){return this.instance||(this.instance=new a),this.instance}attachMouseEvent(t){this.mouseEventList.push(t)}attachKeyboardEvent(t){this.keyboardEventList.push(t)}detach(t){let e=this.mouseEventList.indexOf(t);e>-1&&this.mouseEventList.splice(e,1),e=this.keyboardEventList.indexOf(t),e>-1&&this.keyboardEventList.splice(e,1)}notify(t){t instanceof KeyboardEvent?this.keyboardEventList.forEach((e=>{e.handleInput(new o(t))})):t instanceof MouseEvent&&this.mouseEventList.forEach((e=>{e.handleInput(new o(t))}))}addEventListener(t){document.addEventListener(t,(t=>{t.preventDefault(),this.notify(t)}),!1)}}const c=a;class l{constructor(){this.rigidBodyList=[]}static getInstance(){return this.instance||(this.instance=new l),this.instance}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}attach(t){this.rigidBodyList.push(t)}detach(t){const e=this.rigidBodyList.indexOf(t);e>-1&&this.rigidBodyList.splice(e,1)}update(t){let e=t/1e3;this.rigidBodyList.forEach((t=>{t.getPhysicsEffect()&&(t.getAccelerationEffect()?(t.setShiftX(Math.floor(.5*this.accelerationX*e*e+t.getVelocityX()*e)),t.setShiftY(Math.floor(.5*this.accelerationY*e*e+t.getVelocityY()*e)),t.setVelocityX(Math.floor(t.getVelocityX()+this.accelerationX*e)),t.setVelocityY(Math.floor(t.getVelocityY()+this.accelerationY*e))):(t.setShiftX(Math.floor(t.getVelocityX()*e)),t.setShiftY(Math.floor(t.getVelocityY()*e))))}))}}const d=l;class g{constructor(){this.texList=[]}static getInstance(){return this.instance||(this.instance=new g),this.instance}loadImage(t){let e=n.getInstance().loadImageAndCreateTextureInfo("assets/images/"+t);this.texList.push(e)}getTex(t){return t>=0&&t<this.texList.length?this.texList[t]:this.texList[0]}}const u=g,p=class{constructor(){this.inputHandler=c.getInstance(),this.sceneManager=r.getInstance(),this.physicsManager=d.getInstance(),this.resourceManager=u.getInstance(),this.lastTime=window.performance.now(),this.setup()}update(){let t=window.performance.now();this.physicsManager.update(t-this.lastTime),this.sceneManager.update(t-this.lastTime),this.lastTime=t}render(){this.sceneManager.render()}run(){this.update(),this.render(),requestAnimationFrame((()=>{this.run()}))}};class L{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}add(t){let e=new L(0,0);return e.setX(this.x+t.getX()),e.setY(this.y+t.getY()),e}sub(t){let e=new L(0,0);return e.setX(this.x-t.getX()),e.setY(this.y-t.getY()),e}assign(t){this.x=t.getX(),this.y=t.getY()}copy(){return new L(this.x,this.y)}}const I=L,w={VELOCITY_CHANGING_INTERVAL:1e3,TREX_VELOCITY_X:0,TREX_VELOCITY_Y:0,TREX_JUMPING_VELOCITY:600,TREX_JUMPING_ACCESSLATION:-2e3,TREX_CANVAS_LOCATION:new I(100,240),TREX_CHANGING_INTERVAL:100,MAI_CANVAS_LOCATION:new I(95,225),OBSTACLE_GENERATING_INTERVAL:2e3,CACTUS_VELOCITY_X:450,CACTUS_VELOCITY_Y:0,CACTUS_CANVAS_LOCATION:new I(1500,252),BIRD_VELOCITY_X:450,BIRD_VELOCITY_Y:0,BIRD_HIGH_CANVAS_LOCATION:new I(1500,242),BIRD_LOW_CANVAS_LOCATION:new I(1500,267),BIRD_CHANGING_INTERVAL:300,GROUND_VELOCITY_X:450,GROUND_VELOCITY_Y:0,GROUND_CANVAS_LOCATION:new I(0,292),BACKGROUND_CANVAS_LOCATION:new I(0,0),CLOUD_VELOCITY_X:200,CLOUD_VELOCITY_Y:0,CLOUD_CANVAS_LOCATION:new I(1500,132),CLOUD_GENERATING_INTERVAL:3e3,CLOUD_LOW_Y:162,CLOUD_HIGH_Y:238,SCOREBOARD_CANVAS_LOCATION:new I(1e3,82),SCOREBOARD_SCORE_CHANGING_INTERVAL:100},E=class{constructor(){this.objectList=[],this.toAddObjectList=[],this.toRemoveObjectList=[],this.inputHandler=c.getInstance(),this.isUpdated=!0,this.isRendered=!0,this.played=!1,this.setup()}getState(){return this.state}setState(t){this.state=t}render(){this.synchronize(),this.isRendered&&this.objectList.forEach((t=>{t.render()}))}update(t){this.isUpdated?(this.objectList.forEach((e=>{e.update(t)})),this.played&&this.audio&&this.audio.paused&&this.audio.play()):this.audio&&!this.audio.paused&&this.audio.pause()}synchronize(){let t;this.toAddObjectList.forEach((t=>{this.objectList.push(t)})),this.objectList.sort(((t,e)=>t.getZIndex()>e.getZIndex()?1:t.getZIndex()<e.getZIndex()?-1:0)),this.toAddObjectList.length=0,this.toRemoveObjectList.forEach((e=>{t=this.objectList.indexOf(e),t>-1&&this.objectList.splice(t,1)})),this.toRemoveObjectList.length=0}addObject(t){this.toAddObjectList.push(t),t.attachScene(this)}removeObject(t){this.toRemoveObjectList.push(t)}getObjectList(){return this.objectList}setObjectList(t){this.objectList=t}clearObjectList(){this.objectList.length=0}pause(){this.isUpdated=!1}resume(){this.isUpdated=!0}stop(){this.isUpdated=!1,this.isRendered=!1}start(){this.reload(),this.isUpdated=!0,this.isRendered=!0}getIsRendered(){return this.isRendered}setIsRendered(t){this.isRendered=t}getIsUpdated(){return this.isUpdated}setIsUpdated(t){this.isUpdated=t}},f=class{constructor(t,e,i){this.velocityX=t,this.velocityY=e,this.mass=i,this.accelerationEffect=!1,this.physicsEffect=!0,this.shiftX=0,this.shiftY=0,d.getInstance().attach(this)}getVelocityX(){return this.velocityX}getVelocityY(){return this.velocityY}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}getMass(){return this.mass}setMass(t){this.mass=t}getAccelerationEffect(){return this.accelerationEffect}setAccelerationEffect(t){this.accelerationEffect=t}getPhysicsEffect(){return this.physicsEffect}setPhysicsEffect(t){this.physicsEffect=t}getShiftX(){return this.shiftX}setShiftX(t){this.shiftX=t}getShiftY(){return this.shiftY}setShiftY(t){this.shiftY=t}},A=class{constructor(t,e,i,s){this.location=t.copy(),this.colliderList=[],this.rigidBody=new f(0,0,0),this.inputHandler=c.getInstance(),this.sceneManager=r.getInstance(),this.physicsManager=d.getInstance(),this.resourceManager=u.getInstance(),this.zIndex=e||0,this.angle=i||0,this.rotatingRatio=s?s.copy():new I(.5,.5),this.isRendered=!0,this.isDestroyed=!1}getLocation(){return this.location}setLocation(t){this.location=t.copy()}getX(){return this.location.getX()}setX(t){this.location.setX(t)}getY(){return this.location.getY()}setY(t){this.location.setY(t)}getAngle(){return this.angle}setAngle(t){this.angle=t}getRotatingRatio(){return this.rotatingRatio}setRotatingRatio(t){this.rotatingRatio=t.copy()}getRotatingRatioX(){return this.rotatingRatio.getX()}setRotatingRatioX(t){this.rotatingRatio.setX(t)}getRotatingRatioY(){return this.rotatingRatio.getY()}setRotatingRatioY(t){this.rotatingRatio.setY(t)}getZIndex(){return this.zIndex}setZIndex(t){this.zIndex=t}getIsRendered(){return this.isRendered}setIsRendered(t){this.isRendered=t}getState(){return this.state}setState(t){this.state=t}handleInputState(t){this.state.handleInput(this,t)}updateState(t){this.state.update(this,t)}getColliderList(){return this.colliderList}setColliderList(t){this.colliderList=t}addCollider(t){this.colliderList.push(t)}clearColliderList(){this.colliderList.length=0}getVelocityX(){return this.rigidBody.getVelocityX()}setVelocityX(t){this.rigidBody.setVelocityX(t)}getVelocityY(){return this.rigidBody.getVelocityY()}setVelocityY(t){this.rigidBody.setVelocityY(t)}getShiftX(){return this.rigidBody.getShiftX()}getShiftY(){return this.rigidBody.getShiftY()}getMass(){return this.rigidBody.getMass()}setMass(t){this.rigidBody.setMass(t)}setAccelerationEffect(t){this.rigidBody.setAccelerationEffect(t)}setPhysicsEffect(t){this.rigidBody.setPhysicsEffect(t)}attachScene(t){this.scene=t}getScene(){return this.scene}getTex(){return this.tex}setTex(t){this.tex=t}isColliedWith(t){for(let e=0;e<this.colliderList.length;e++)for(let i=0;i<t.colliderList.length;i++){let s,n,h,r;if(s=this.colliderList[e].getOrigin(),s=s.add(this.location),n=new I(s.getX()+this.colliderList[e].getWidth(),s.getY()+this.colliderList[e].getHeight()),h=t.colliderList[i].getOrigin(),h=h.add(t.location),r=new I(h.getX()+t.colliderList[i].getWidth(),h.getY()+t.colliderList[i].getHeight()),!(n.getX()-h.getX()<=-2||r.getX()-s.getX()<=-2||n.getY()-h.getY()<=-2||r.getY()-s.getY()<=-2))return!0}return!1}destroy(){this.inputHandler.detach(this),this.physicsManager.detach(this.rigidBody),this.isDestroyed=!0}getIsDestroyed(){return this.isDestroyed}handleInput(t){}update(t){}render(){}},_=class extends A{constructor(t,e,i){i?super(t,i):super(t),this.sprite=e}render(){this.getIsRendered()&&n.getInstance().draw(this.getTex(),this.sprite.coor.getX(),this.sprite.coor.getY(),this.sprite.width,this.sprite.height,this.getX(),this.getY(),this.sprite.width*this.sprite.scale,this.sprite.height*this.sprite.scale,this.getRotatingRatioX(),this.getRotatingRatioY(),this.getAngle()/180*Math.PI)}setSprite(t){this.sprite=t}getWidth(){return this.sprite.width*this.sprite.scale}getHeight(){return this.sprite.height*this.sprite.scale}},T={LAM_SPRITE:{clip:{coor:new I(0,0),width:123,height:176,scale:.35},adjust:new I(0,0)},MAI_SPRITE:{clip:{coor:new I(0,0),width:78,height:119,scale:.7},adjust:new I(0,0)},CLOUD_SPRITE:{clip:{coor:new I(164,0),width:96,height:32,scale:.5},adjust:new I(0,0)},BIRD_SPRITE:[{clip:{coor:new I(262,16),width:88,height:64,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(354,4),width:88,height:56,scale:.5},adjust:new I(0,-4)}],OBSTACLE_SPRITE:{clip:{coor:new I(0,0),width:100,height:105,scale:.5},adjust:new I(0,0)},CACTUS_SPRITES:[{clip:{coor:new I(446,2),width:34,height:70,scale:.5},adjust:new I(0,14)},{clip:{coor:new I(480,2),width:68,height:70,scale:.5},adjust:new I(0,14)},{clip:{coor:new I(548,2),width:102,height:70,scale:.5},adjust:new I(0,14)},{clip:{coor:new I(652,2),width:50,height:100,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(702,2),width:48,height:100,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(752,2),width:98,height:100,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(850,2),width:102,height:100,scale:.5},adjust:new I(0,0)}],TREX_SPRITES:[{clip:{coor:new I(1516,4),width:84,height:90,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(1604,4),width:84,height:90,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(1868,38),width:114,height:56,scale:.5},adjust:new I(0,16)},{clip:{coor:new I(1986,38),width:114,height:56,scale:.5},adjust:new I(0,16)},{clip:{coor:new I(1340,4),width:84,height:90,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(1428,4),width:84,height:90,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(1692,4),width:84,height:90,scale:.5},adjust:new I(0,0)},{clip:{coor:new I(78,6),width:88,height:92,scale:.5},adjust:new I(0,0)}],GROUND_SPRITE:{clip:{coor:new I(0,102),width:2404,height:28,scale:.5},adjust:new I(0,0)},BACKGROUND_SPRITE:{clip:{coor:new I(0,0),width:4191,height:2101,scale:.24},adjust:new I(0,0)},GAMEOVER_1_SPRITE:{clip:{coor:new I(0,0),width:2930,height:621,scale:.1},adjust:new I(0,0)},NUMBER_SPRITES:{0:{clip:{coor:new I(952,0),width:22,height:26,scale:.5},adjust:new I(0,0)},1:{clip:{coor:new I(974,0),width:20,height:26,scale:.5},adjust:new I(0,0)},2:{clip:{coor:new I(992,0),width:22,height:26,scale:.5},adjust:new I(0,0)},3:{clip:{coor:new I(1012,0),width:22,height:26,scale:.5},adjust:new I(0,0)},4:{clip:{coor:new I(1032,0),width:22,height:26,scale:.5},adjust:new I(0,0)},5:{clip:{coor:new I(1052,0),width:22,height:26,scale:.5},adjust:new I(0,0)},6:{clip:{coor:new I(1072,0),width:22,height:26,scale:.5},adjust:new I(0,0)},7:{clip:{coor:new I(1092,0),width:22,height:26,scale:.5},adjust:new I(0,0)},8:{clip:{coor:new I(1112,0),width:22,height:26,scale:.5},adjust:new I(0,0)},9:{clip:{coor:new I(1132,0),width:22,height:26,scale:.5},adjust:new I(0,0)}},HI_SPRITE:{clip:{coor:new I(1152,0),width:42,height:26,scale:.5},adjust:new I(0,0)},GAMEOVER_SPRITE:{clip:{coor:new I(952,28),width:384,height:24,scale:.75},adjust:new I(0,0)},PLAY_BUTTON_SPRITE:{clip:{coor:new I(2,2),width:72,height:64,scale:.5},adjust:new I(0,0)}},R=class extends _{constructor(){super(new I(350,160),T.GAMEOVER_1_SPRITE.clip),this.setTex(this.resourceManager.getTex(6))}handleInput(t){}update(t){}contentToSpriteList(){}},C=class extends _{constructor(t,e,i){i?super(t,e,i):super(t,e),this.callbackList=[],this.clicked=!0,this.isActive=!0,this.mouseDown=!0}handleInput(t){if(this.isActive){const e=t.getEvent();e instanceof Event&&e instanceof MouseEvent&&(e.x>=this.getLocation().getX()&&e.y>=this.getLocation().getY()&&e.x<=this.getLocation().getX()+this.getWidth()&&e.y<=this.getLocation().getY()+this.getHeight()?this.clicked?"mousedown"==e.type?this.mouseDown&&(this.mouseDown=!1):"mouseup"==e.type&&(this.mouseDown||this.callbackList.forEach((t=>{t()}))):this.callbackList.forEach((t=>{t()})):this.mouseDown=!0)}}setClicked(t){this.clicked=t}setActive(t){this.isActive=t}attach(t){this.callbackList.push(t)}},O=class extends C{constructor(t,e,i){i?super(t,e,i):super(t,e),this.setTex(this.resourceManager.getTex(0))}update(t){}},y=class extends E{constructor(){super()}handleInput(t){}reload(){this.replayButton.setActive(!0)}setup(){this.gameOver=new R,this.replayButton=new O(new I(480,230),T.PLAY_BUTTON_SPRITE.clip,2),this.inputHandler.attachMouseEvent(this.replayButton),this.replayButton.setActive(!0),this.replayButton.attach((()=>{this.replayButton.setActive(!1),this.stop(),r.getInstance().startScene(0)})),this.addObject(this.gameOver),this.addObject(this.replayButton)}},S=class extends A{constructor(t,e){e?super(t,e):super(t),this.spriteList=[],this.content="",this.letterGap=1}render(){if(this.getIsRendered()){const t=n.getInstance();let e=0;this.spriteList.forEach((i=>{t.draw(this.getTex(),i.coor.getX(),i.coor.getY(),i.width,i.height,this.getX()+e,this.getY(),i.width*i.scale,i.height*i.scale),e+=i.width*i.scale+this.letterGap}))}}getContent(){return this.content}setContent(t){this.content=t,this.contentToSpriteList()}},x=class extends S{constructor(t){super(new I(880,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("00000"),this.changingInterval=t}handleInput(t){}update(t){if(this.changingInterval-t<0){this.changingInterval=w.SCOREBOARD_SCORE_CHANGING_INTERVAL;let t=Number(this.getContent());t+=1;let e,i="";for(let s=4;s>-1;s--)e=Math.floor(t/10**s),t%=10**s,i+=String(e);this.setContent(i)}else this.changingInterval-=t}reload(){this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(T.NUMBER_SPRITES[this.content[t]].clip)}},v=class extends S{constructor(){super(new I(785,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("00000"),window.localStorage.setItem("high_score",this.getContent())}handleInput(t){}update(t){}reload(){const t=window.localStorage.getItem("high_score");t?this.setContent(t):this.setContent("00000")}contentToSpriteList(){this.spriteList.length=0;for(let t=0;t<this.content.length;t++)this.spriteList.push(T.NUMBER_SPRITES[this.content[t]].clip)}},b=class extends S{constructor(){super(new I(750,182)),this.setTex(this.resourceManager.getTex(0)),this.setContent("HI")}handleInput(t){}update(t){}contentToSpriteList(){this.spriteList.length=0,this.spriteList.push(T.HI_SPRITE.clip)}},m=class extends A{constructor(t,e){e?super(t,e):super(t),this.highPoint=new v,this.currentPoint=new x(w.SCOREBOARD_SCORE_CHANGING_INTERVAL),this.HI=new b,this.isUpdated=!0}handleInput(t){}update(t){this.isUpdated&&(this.highPoint.update(t),this.currentPoint.update(t),this.HI.update(t),this.updateHighScore())}render(){this.getIsRendered()&&(this.highPoint.render(),this.currentPoint.render(),this.HI.render())}reload(){this.highPoint.reload(),this.currentPoint.reload()}setIsUpdated(t){this.isUpdated=t}updateHighScore(){Number(this.highPoint.getContent())<Number(this.currentPoint.getContent())&&window.localStorage.setItem("high_score",this.currentPoint.getContent())}},j=38,N=32,Y=class{constructor(){}},X=class{constructor(t,e,i){this.origin=t,this.width=e,this.height=i}getOrigin(){return this.origin}getWidth(){return this.width}getHeight(){return this.height}setOrigin(t){this.origin=t}setWidth(t){this.width=t}setHeight(t){this.height=t}},V=[new X(new I(4,12),34,40)];class M extends Y{constructor(){super(),this.rotateForward=!0}handleInput(t,e){const i=e.getEvent();i instanceof Event?i instanceof KeyboardEvent&&"keydown"==i.type&&(i.keyCode!=N&&i.keyCode!=j||i.repeat||(t.setAngle(0),t.setState(new U),t.setVelocityY(w.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0))):"gameover"==i&&t.setState(new G)}update(t,e){this.rotateForward?t.getAngle()<30?t.setAngle(t.getAngle()+1):this.rotateForward=!1:t.getAngle()>-10?t.setAngle(t.getAngle()-1):this.rotateForward=!0}}class U extends Y{constructor(){super()}handleInput(t,e){"gameover"==e.getEvent()&&t.setState(new G)}update(t,e){let i=t.getShiftY(),s=t.getLocation().copy();s.getY()-i>w.TREX_CANVAS_LOCATION.getY()||s.getY()<0?(s.setY(w.TREX_CANVAS_LOCATION.getY()),t.setLocation(s),t.setVelocityY(0),t.setAccelerationEffect(!1),t.setState(new M)):(s.setY(s.getY()-i),t.setLocation(s))}}class G extends Y{constructor(){super()}handleInput(t,e){"play"==e.getEvent()&&(t.setY(w.TREX_CANVAS_LOCATION.getY()),t.setState(new M),t.setColliderList(V))}update(t,e){}}const B=class extends Y{constructor(){super()}handleInput(t,e){const i=e.getEvent();i instanceof Event&&i instanceof KeyboardEvent&&(i.keyCode!=N&&i.keyCode!=j||i.repeat||(t.setState(new U),t.setColliderList(V),t.setVelocityY(w.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0),t.getScene().handleInput(new o("play"))))}update(t,e){}},D=class extends _{constructor(t,e){e?super(t,T.LAM_SPRITE.clip,e):super(t,T.LAM_SPRITE.clip),this.setTex(this.resourceManager.getTex(1)),this.setState(new B),this.onCollideWithDictionary={},this.onCollideWithList=[]}handleInput(t){this.handleInputState(t)}update(t){this.updateState(t),this.onCollideWithList.forEach((t=>{this.isColliedWith(t)&&this.onCollideWithDictionary[JSON.stringify(t)].forEach((t=>{t()}))}))}onCollideWith(t,e){this.onCollideWithDictionary[JSON.stringify(t)]||(this.onCollideWithDictionary[JSON.stringify(t)]=[]),this.onCollideWithDictionary[JSON.stringify(t)].push(e),this.onCollideWithList.indexOf(t)<0&&this.onCollideWithList.push(t)}},P=[new X(new I(4,12),0,0)];class H extends Y{constructor(){super(),this.rotateForward=!1}handleInput(t,e){const i=e.getEvent();i instanceof Event?i instanceof KeyboardEvent&&"keydown"==i.type&&(i.keyCode!=N&&i.keyCode!=j||i.repeat||(t.setAngle(80),t.setState(new W),t.setVelocityY(w.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0))):"gameover"==i&&t.setState(new F)}update(t,e){this.rotateForward?t.getAngle()<100?t.setAngle(t.getAngle()+1):this.rotateForward=!1:t.getAngle()>60?t.setAngle(t.getAngle()-1):this.rotateForward=!0}}class W extends Y{constructor(){super()}handleInput(t,e){"gameover"==e.getEvent()&&t.setState(new F)}update(t,e){let i=t.getShiftY(),s=t.getLocation().copy();s.getY()-i>w.MAI_CANVAS_LOCATION.getY()||s.getY()<0?(s.setY(w.MAI_CANVAS_LOCATION.getY()),t.setLocation(s),t.setVelocityY(0),t.setAccelerationEffect(!1),t.setState(new H)):(s.setY(s.getY()-i),t.setLocation(s))}}class F extends Y{constructor(){super()}handleInput(t,e){"play"==e.getEvent()&&(t.setY(w.MAI_CANVAS_LOCATION.getY()),t.setState(new H),t.setColliderList(P))}update(t,e){}}const k=class extends Y{constructor(){super()}handleInput(t,e){const i=e.getEvent();i instanceof Event&&i instanceof KeyboardEvent&&(i.keyCode!=N&&i.keyCode!=j||i.repeat||(t.setState(new W),t.setColliderList(P),t.setVelocityY(w.TREX_JUMPING_VELOCITY),t.setAccelerationEffect(!0)))}update(t,e){}},J=class extends _{constructor(t,e){e?super(t,T.MAI_SPRITE.clip,e):super(t,T.MAI_SPRITE.clip),this.setTex(this.resourceManager.getTex(4)),this.setAngle(80),this.setState(new k),this.onCollideWithDictionary={},this.onCollideWithList=[]}handleInput(t){this.handleInputState(t)}update(t){this.updateState(t),this.onCollideWithList.forEach((t=>{this.isColliedWith(t)&&this.onCollideWithDictionary[JSON.stringify(t)].forEach((t=>{t()}))}))}onCollideWith(t,e){this.onCollideWithDictionary[JSON.stringify(t)]||(this.onCollideWithDictionary[JSON.stringify(t)]=[]),this.onCollideWithDictionary[JSON.stringify(t)].push(e),this.onCollideWithList.indexOf(t)<0&&this.onCollideWithList.push(t)}},K=[new X(new I(3,9),38,40)],z=class extends _{constructor(t){super(t,T.OBSTACLE_SPRITE.clip),this.setTex(this.resourceManager.getTex(3)),this.setColliderList(K),this.setVelocityX(w.CACTUS_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},Z=function(t,e){let i=e-t+1;return Math.floor(Math.random()*i+t)},q=class extends A{constructor(t,e,i,s){s?super(t,s):super(t),this.previousShift=new I(0,0),this.spriteList=i,this.adjustList=[],this.collidersList=[],this.changingInterval=e,this.remainingInterval=this.changingInterval,this.index=0}animate(t){this.spriteList.length>0&&(this.remainingInterval<0?(this.remainingInterval=this.changingInterval,this.setLocation(this.getLocation().sub(this.previousShift)),this.index=(this.index+1)%this.spriteList.length,this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index]),this.index>=0&&this.index<this.collidersList.length&&this.setColliderList(this.collidersList[this.index])):this.remainingInterval-=t)}render(){if(this.getIsRendered()){const t=n.getInstance();if(this.spriteList.length>0){let e=this.getLocation();this.index>=0&&this.index<this.adjustList.length&&(e=e.add(this.adjustList[this.index])),t.draw(this.getTex(),this.spriteList[this.index].coor.getX(),this.spriteList[this.index].coor.getY(),this.spriteList[this.index].width,this.spriteList[this.index].height,this.getX(),this.getY(),this.spriteList[this.index].width*this.spriteList[this.index].scale,this.spriteList[this.index].height*this.spriteList[this.index].scale)}}}getCurrentSprite(){return this.spriteList[this.index]}setSpriteList(t){this.index=0,this.setLocation(this.getLocation().sub(this.previousShift)),this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index]),this.spriteList=t}setAdjustList(t){this.adjustList=t,this.setLocation(this.getLocation().sub(this.previousShift)),this.index>=0&&this.index<this.adjustList.length&&(this.setLocation(this.getLocation().add(this.adjustList[this.index])),this.previousShift=this.adjustList[this.index])}setCollidersList(t){t.length>0&&this.setColliderList(t[0]),this.collidersList=t}getWidth(){return this.spriteList.length>0?this.spriteList[this.index].width*this.spriteList[this.index].scale:0}getHeight(){return this.spriteList.length>0?this.spriteList[this.index].height*this.spriteList[this.index].scale:0}},Q=class extends A{constructor(t){super(new I(0,0)),this.objectList=[],this.obstacleGeneratingInterval=w.OBSTACLE_GENERATING_INTERVAL,this.setVelocityX(w.GROUND_VELOCITY_X),this.velocityChangingInterval=w.VELOCITY_CHANGING_INTERVAL,this.trex=t}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){for(let t=0;t<this.objectList.length;t++)if(this.trex.isColliedWith(this.objectList[t]))return this.getScene().setState("gameover"),this.trex.handleInput(new o(this.getScene().getState())),r.getInstance().startScene(1),void r.getInstance().pauseScene(0);if(this.obstacleGeneratingInterval-t<0){let t=Z(-1e3,1e3);this.obstacleGeneratingInterval=w.OBSTACLE_GENERATING_INTERVAL+t,this.obstacleGeneratingInterval=Math.floor(450*this.obstacleGeneratingInterval/this.getVelocityX()),this.spawn()}else this.obstacleGeneratingInterval-=t;this.velocityChangingInterval-t<0?(this.velocityChangingInterval=w.VELOCITY_CHANGING_INTERVAL,this.setVelocityX(this.getVelocityX()+1),this.objectList.forEach((t=>{t.setVelocityX(this.getVelocityX())}))):this.velocityChangingInterval-=t;let e=[];this.objectList.forEach((t=>{(t instanceof _||t instanceof q)&&t.getX()+t.getWidth()<0&&e.push(t)})),e.forEach((t=>{this.removeObject(t),this.getScene().removeObject(t),t.destroy()}))}spawn(){let t;t=new z(w.CACTUS_CANVAS_LOCATION),t.setVelocityX(this.getVelocityX()),this.addObject(t),this.getScene().addObject(t)}},$=class extends _{constructor(t){super(t,T.CLOUD_SPRITE.clip),this.setTex(this.resourceManager.getTex(0)),this.setVelocityX(w.CLOUD_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},tt=class extends A{constructor(){super(new I(0,0)),this.objectList=[],this.cloudGeneratingInterval=w.CLOUD_GENERATING_INTERVAL}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){this.cloudGeneratingInterval-t<0?(this.cloudGeneratingInterval=w.CLOUD_GENERATING_INTERVAL,this.spawn()):this.cloudGeneratingInterval-=t;let e=[];this.objectList.forEach((t=>{(t instanceof _||t instanceof q)&&t.getX()+t.getWidth()<0&&e.push(t)})),e.forEach((t=>{this.removeObject(t),this.getScene().removeObject(t),t.destroy()}))}spawn(){const t=Z(w.CLOUD_LOW_Y,w.CLOUD_HIGH_Y),e=w.CLOUD_CANVAS_LOCATION.copy();e.setY(t);const i=new $(e);this.addObject(i),this.getScene().addObject(i)}},et=class extends _{constructor(t){super(t,T.GROUND_SPRITE.clip),this.setTex(this.resourceManager.getTex(0)),this.setVelocityX(w.GROUND_VELOCITY_X)}handleInput(t){}update(t){let e=this.getShiftX();this.setX(this.getX()-e)}},it=class extends A{constructor(){super(new I(0,0)),this.objectList=[],this.setVelocityX(w.GROUND_VELOCITY_X),this.velocityChangingInterval=w.VELOCITY_CHANGING_INTERVAL}addObject(t){this.objectList.push(t)}removeObject(t){const e=this.objectList.indexOf(t);e>-1&&this.objectList.splice(e,1)}clearObjectList(){this.objectList.length=0}update(t){this.objectList.forEach((e=>{e.update(t)}));for(let t=0;t<this.objectList.length;t++)if(this.objectList[t].getX()+this.objectList[t].getWidth()<0){let e=new I(this.objectList[t].getX()+3*this.objectList[t].getWidth(),this.objectList[t].getY());const i=new et(e);i.setVelocityX(this.getVelocityX()),this.addObject(i),this.objectList[t].destroy(),this.removeObject(this.objectList[t]);break}this.velocityChangingInterval-t<0?(this.velocityChangingInterval=w.VELOCITY_CHANGING_INTERVAL,this.setVelocityX(this.getVelocityX()+1),this.objectList.forEach((t=>{t.setVelocityX(this.getVelocityX())}))):this.velocityChangingInterval-=t}render(){this.objectList.forEach((t=>{t.render()}))}setup(){let t,e=w.GROUND_CANVAS_LOCATION.copy();for(let i=0;i<3;i++)t=new et(e),this.addObject(t),e=new I(e.getX()+t.getWidth(),e.getY())}},st=class extends _{constructor(t){super(t,T.BACKGROUND_SPRITE.clip,-10),this.setTex(this.resourceManager.getTex(5))}handleInput(t){}update(t){}},nt="play",ht=class extends E{constructor(){super(),this.setState("start"),this.audio=new Audio("../../assets/sounds/theme.mp3"),this.audio.loop=!0}handleInput(t){t.getEvent()==nt&&(this.setState(nt),this.reload())}reload(){this.played||(this.audio.play(),this.played=!0),this.setState(nt),this.obstacleGroup.setVelocityX(w.GROUND_VELOCITY_X),this.groundGroup.setVelocityX(w.GROUND_VELOCITY_X),this.getObjectList().forEach((t=>{t instanceof D||t instanceof m||t instanceof J||t.destroy()})),this.objectList.length=0,this.addObject(this.obstacleGroup),this.obstacleGroup.clearObjectList(),this.addObject(this.cloudGroup),this.cloudGroup.clearObjectList(),this.addObject(this.groundGroup),this.groundGroup.clearObjectList(),this.groundGroup.setup(),this.addObject(this.background),this.scoreBoard.reload(),this.scoreBoard.setIsRendered(!0),this.scoreBoard.setIsUpdated(!0),this.addObject(this.scoreBoard),this.trex.handleInput(new o(this.getState())),this.addObject(this.trex),this.mai.handleInput(new o(this.getState())),this.addObject(this.mai)}setup(){this.background=new st(w.BACKGROUND_CANVAS_LOCATION),this.addObject(this.background),this.mai=new J(w.MAI_CANVAS_LOCATION,1),this.addObject(this.mai),this.inputHandler.attachKeyboardEvent(this.mai),this.trex=new D(w.TREX_CANVAS_LOCATION,2),this.addObject(this.trex),this.inputHandler.attachKeyboardEvent(this.trex),this.obstacleGroup=new Q(this.trex),this.cloudGroup=new tt,this.groundGroup=new it,this.scoreBoard=new m(w.SCOREBOARD_CANVAS_LOCATION,1),this.scoreBoard.setIsRendered(!1),this.scoreBoard.setIsUpdated(!1),this.addObject(this.scoreBoard)}};(new class extends p{constructor(){super()}setup(){this.resourceManager.loadImage("trex-sprites.png"),this.resourceManager.loadImage("lam-rex.png"),this.resourceManager.loadImage("small-red-square.png"),this.resourceManager.loadImage("obstacle.png"),this.resourceManager.loadImage("mai.png"),this.resourceManager.loadImage("background.png"),this.resourceManager.loadImage("gameover.png"),this.physicsManager.setAccelerationX(0),this.physicsManager.setAccelerationY(w.TREX_JUMPING_ACCESSLATION);let t=new ht,e=new y;e.stop(),this.sceneManager.addScene(t),this.sceneManager.addScene(e),this.sceneManager.setSceneWidth(1e3),this.sceneManager.setSceneHeight(500),this.inputHandler.addEventListener("keydown"),this.inputHandler.addEventListener("keyup"),this.inputHandler.addEventListener("mousedown"),this.inputHandler.addEventListener("mouseup")}}).run()})();